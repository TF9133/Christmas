<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>控制器</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #fdf8e4; /* 淡黃色背景 */
      padding: 20px;
    }
    .input-group {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div>
    <h1>控制器</h1>
    <div class="input-group">
      <label for="rep-number">代表號</label>
      <input type="number" id="rep-number" placeholder="輸入代表號">
    </div>
    <div class="input-group">
      <label for="room-number">房間號</label>
      <input type="number" id="room-number" placeholder="輸入房間號（1-5）">
    </div>
    <div class="input-group">
      <label for="move-room">移房號</label>
      <input type="number" id="move-room" placeholder="輸入移房號（1-5）">
    </div>
    <button id="move-button">移</button>
    <button id="kill-button">殺</button>
    <div class="input-group">
      <label for="query-number">查詢號碼</label>
      <input type="number" id="query-number" placeholder="輸入號碼進行查詢">
    </div>
    <button id="query-button">查詢</button>
    <div id="status-message"></div>
  </div>

  <script>
    // 初始化數據
    if (!localStorage.getItem("randomNumbers")) {
      const randomNumbers = Array(26).fill(null).map((_, i) => i + 1); // 生成1到26的號碼
      localStorage.setItem("randomNumbers", JSON.stringify(randomNumbers));
      localStorage.setItem("eliminated", JSON.stringify([]));
    }

    // 更新顯示器數據
    function updateDisplay() {
      const displayWindow = window.open('display.html', '_blank');
      if (displayWindow) {
        displayWindow.location.reload();
      }
    }

    // 查詢功能
    document.getElementById('query-button').addEventListener('click', () => {
      const queryNumber = parseInt(document.getElementById('query-number').value);
      const randomNumbers = JSON.parse(localStorage.getItem("randomNumbers"));

      // 驗證查詢號碼是否在範圍內
      if (queryNumber < 1 || queryNumber > 26 || isNaN(queryNumber)) {
        alert('請輸入有效的號碼（1到26的範圍）。');
        return;
      }

      // 查找該號碼在隨機數組中的索引
      const index = randomNumbers.indexOf(queryNumber);
      if (index !== -1) {
        document.getElementById('status-message').textContent = `你的號碼為 ${queryNumber}。`;
      } else {
        document.getElementById('status-message').textContent = `號碼 ${queryNumber} 不在列表中，可能已被淘汰。`;
      }
    });

    // 移動號碼功能
    document.getElementById('move-button').addEventListener('click', () => {
      const repNumber = parseInt(document.getElementById('rep-number').value);
      const roomNumber = parseInt(document.getElementById('room-number').value) - 1;
      const moveRoom = parseInt(document.getElementById('move-room').value) - 1;

      const randomNumbers = JSON.parse(localStorage.getItem("randomNumbers"));
      const index = randomNumbers.indexOf(repNumber);

      if (index > -1) {
        // 從原房間移除
        randomNumbers.splice(index, 1);
        // 移動到新房間
        randomNumbers.push(repNumber);

        localStorage.setItem("randomNumbers", JSON.stringify(randomNumbers));
        document.getElementById('status-message').textContent = `代表號 ${repNumber} 移到房間 ${moveRoom + 1}。`;
        updateDisplay();
      } else {
        alert(`代表號 ${repNumber} 不在房間中！`);
      }
    });

    // 淘汰號碼功能
    document.getElementById('kill-button').addEventListener('click', () => {
      const repNumber = parseInt(document.getElementById('rep-number').value);

      const randomNumbers = JSON.parse(localStorage.getItem("randomNumbers"));
      const index = randomNumbers.indexOf(repNumber);

      if (index > -1) {
        // 淘汰該號碼
        randomNumbers.splice(index, 1);
        
        const eliminated = JSON.parse(localStorage.getItem("eliminated"));
        eliminated.push(repNumber);
        localStorage.setItem("eliminated", JSON.stringify(eliminated));

        localStorage.setItem("randomNumbers", JSON.stringify(randomNumbers));
        document.getElementById('status-message').textContent = `你已殺 ${repNumber} 號同學。`;
        updateDisplay();
      } else {
        alert(`代表號 ${repNumber} 不在房間中！`);
      }
    });
  </script>
</body>
</html>
